(function(c){function h(a,c){"function"==typeof a&&(c=a,a={});"object"!=typeof a&&(a={});"function"!=typeof c&&(c=function(){});return{options:a,callback:c}}var f=[];c.fn.dimBackground=function(a,e){var b=h(a,e);a=b.options;e=b.callback;a=c.extend({},c.fn.dimBackground.defaults,a);var d=c('<div class="dimbackground-curtain"></div>');d.css({position:"fixed",left:0,top:0,width:"100%",height:"100%",background:"black",opacity:0,zIndex:a.curtainZIndex});c("body").append(d);this.each(function(){var b=c(this),
e=c.meta?c.extend({},a,b.data()):a;this._$curtain=d;this._originalPosition=b.css("position").toLowerCase();"absolute"!=this._originalPosition&&"fixed"!=this._originalPosition&&b.css("position","relative");this._originalZIndex=b.css("z-index");("auto"==this._originalZIndex||this._originalZIndex<=e.curtainZIndex)&&b.css("z-index",e.curtainZIndex+1)});d.stop().animate({opacity:a.darkness},a.fadeInDuration,e);f.push({$curtain:d,$nodes:this});return this};c.fn.undim=function(a,e){var b=h(a,e);a=b.options;
e=b.callback;a=c.extend({},c.fn.dimBackground.defaults,a);var d,g=[];this.each(function(){var b=c(this);c.meta&&c.extend({},a,b.data());this._$curtain&&(d||(d=this._$curtain),"undefined"!=typeof this._originalPosition&&g.push([this,this._originalPosition,this._originalZIndex]),this._originalZIndex=this._originalPosition=this._$curtain=void 0)});if(d){d.animate({opacity:0},a.fadeOutDuration,function(){for(var a=0;a<g.length;a++){var b=g[a][1],f=g[a][2];c(g[a][0]).css({position:b,zIndex:f})}d.remove();
e()});for(var k,b=0;b<f.length;b++)if(f[b].$curtain==d){k=b;break}k&&(f=f.slice(0,b).concat(f.slice(b+1)))}return this};c.undim=function(a){function c(){b++;b==d&&a()}a="function"==typeof a?a:function(){};_dimmedNodes=f.slice();for(var b=0,d=_dimmedNodes.length,g=0;g<f.length;g++)_dimmedNodes[g].$nodes.undim(c);0==d&&a()};c.fn.dimBackground.defaults={darkness:0.75,fadeInDuration:300,fadeOutDuration:300,curtainZIndex:999}})(jQuery);
